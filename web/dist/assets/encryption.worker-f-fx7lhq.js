(function(){"use strict";self.onmessage=async a=>{const{id:r,action:e,data:t,key:n}=a.data;let o,c;try{switch(e){case"encrypt":if(!n)throw new Error("No encryption key provided");o=await y(t,n);break;case"decrypt":if(!n)throw new Error("No encryption key provided");o=await d(t,n);break;case"generateChecksum":o=await h(t);break;default:throw new Error(`Unknown action: ${e}`)}}catch(i){c=i.message}const s={id:r,result:o,error:c};self.postMessage(s)};async function y(a,r){try{const e=JSON.stringify(a),n=new TextEncoder().encode(e),o=crypto.getRandomValues(new Uint8Array(12)),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:128},r,n),s=new Uint8Array(o.length+c.byteLength);return s.set(o,0),s.set(new Uint8Array(c),o.length),f(s.buffer)}catch(e){throw console.error("Encryption error:",e),new Error("Failed to encrypt data")}}async function d(a,r){try{const e=u(a),t=new Uint8Array(e),n=t.subarray(0,12),o=t.subarray(12),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:128},r,o),i=new TextDecoder().decode(c);return JSON.parse(i)}catch(e){throw console.error("Decryption error:",e),new Error("Failed to decrypt data")}}async function h(a){try{const r=JSON.stringify(a),t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}catch(r){throw console.error("Checksum generation error:",r),new Error("Failed to generate checksum")}}function f(a){const r=new Uint8Array(a);let e="";for(let t=0;t<r.byteLength;t++)e+=String.fromCharCode(r[t]);return btoa(e)}function u(a){const r=atob(a),e=new ArrayBuffer(r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return e}})();
