# 阶段一：基础框架与本地存储实现计划

## 目标
搭建完整的应用框架，实现本地存储功能，确保基本可用性

## 时间估算
- 预计总耗时：2-3 周
- 建议按以下顺序执行子任务

## 详细实现计划

### 1. 应用脚手架搭建

#### 1.1 项目初始化
- **步骤 1**：使用 Vite 创建 React + TypeScript 项目
  - 命令：`npm create vite@latest mindweaver -- --template react-ts`
  - 验证：项目结构创建成功，包含基本的 React 组件

- **步骤 2**：安装核心依赖
  - 基础依赖：`npm install zustand tailwindcss @radix-ui/react-icons framer-motion`
  - 开发依赖：`npm install -D eslint prettier @typescript-eslint/eslint-plugin`
  - 验证：package.json 中依赖项正确配置

#### 1.2 路由与状态管理配置
- **步骤 1**：设置路由系统
  - 安装：`npm install react-router-dom`
  - 配置：创建 `src/routes.tsx` 文件，定义 7 个核心模块的路由
  - 验证：路由跳转功能正常，URL 路径与模块对应

- **步骤 2**：配置 Zustand 状态管理
  - 创建 `src/store` 目录
  - 实现 `themeStore.ts`：主题状态管理
  - 实现 `userStore.ts`：用户状态管理
  - 实现 `workStore.ts`：作品状态管理
  - 验证：状态更新和订阅机制正常工作

#### 1.3 主题系统与暗黑模式
- **步骤 1**：配置 Tailwind CSS
  - 初始化：`npx tailwindcss init -p`
  - 配置：修改 `tailwind.config.js`，添加主题变量
  - 验证：Tailwind 类名正常生效

- **步骤 2**：实现主题切换功能
  - 创建 `src/styles/globals.css`，定义主题变量
  - 实现亮色/暗色主题的 CSS 变量
  - 验证：主题切换功能正常，界面样式相应变化

### 2. 侧边栏与导航系统

#### 2.1 7个核心模块的导航结构
- **步骤 1**：创建侧边栏组件
  - 实现 `src/components/Sidebar.tsx`
  - 定义 7 个导航项：账户、素材、作品、模板、市场、仪表盘、设置
  - 验证：侧边栏显示完整，导航项点击功能正常

- **步骤 2**：实现导航状态管理
  - 为每个导航项添加激活状态
  - 实现导航项的悬停、点击效果
  - 验证：导航状态正确反映当前页面

#### 2.2 响应式布局与状态管理
- **步骤 1**：实现响应式设计
  - 配置 Tailwind 断点：sm, md, lg, xl
  - 实现侧边栏的响应式显示/隐藏
  - 验证：在不同屏幕尺寸下布局正常

- **步骤 2**：状态管理集成
  - 连接导航状态与路由
  - 实现页面切换的平滑过渡
  - 验证：状态更新与 UI 变化同步

#### 2.3 用户信息展示区域
- **步骤 1**：实现用户信息卡片
  - 创建 `src/components/UserInfoCard.tsx`
  - 显示用户头像、昵称、邮箱
  - 验证：用户信息正确显示

- **步骤 2**：添加用户信息编辑入口
  - 实现点击进入账户设置的功能
  - 添加用户信息的悬停提示
  - 验证：编辑入口功能正常

### 3. 本地存储系统

#### 3.1 IndexedDB 适配器实现
- **步骤 1**：创建存储服务目录结构
  - 目录：`src/services/storage`
  - 实现：`IndexedDBAdapter.ts`
  - 验证：目录结构创建完成

- **步骤 2**：实现基本的 IndexedDB 操作
  - 数据库初始化
  - 对象存储创建
  - 基本的 CRUD 操作
  - 验证：数据库操作功能正常

#### 3.2 数据加密与安全存储
- **步骤 1**：实现加密服务
  - 创建 `src/services/storage/encryption` 目录
  - 实现 `EncryptionService.ts`：基于 Web Crypto API
  - 实现 `KeyManager.ts`：密钥管理
  - 验证：加密/解密功能正常

- **步骤 2**：集成加密到存储系统
  - 在数据存储前加密
  - 在数据读取后解密
  - 验证：加密存储和安全读取功能正常

#### 3.3 缓存策略与性能优化
- **步骤 1**：实现 LRU 缓存
  - 创建 `src/services/storage/utils/LRUCache.ts`
  - 配置缓存大小限制：作品缓存 20MB，模板缓存 5MB
  - 验证：缓存功能正常工作

- **步骤 2**：性能优化
  - 实现数据分片存储
  - 配置缓存清理定时器
  - 验证：存储操作性能良好

#### 3.4 存储使用情况监控
- **步骤 1**：实现存储监控功能
  - 添加存储使用情况统计
  - 实现存储清理建议
  - 验证：存储监控数据准确

### 4. 作品管理基础

#### 4.1 作品列表展示
- **步骤 1**：创建作品页面组件
  - 实现 `src/components/WorksPage.tsx`
  - 实现卡片/网格视图
  - 验证：作品列表正确显示

- **步骤 2**：实现作品卡片
  - 创建 `src/components/WorkCard.tsx`
  - 显示作品标题、创建时间、节点数量
  - 验证：作品卡片信息完整

#### 4.2 基本的创建、删除操作
- **步骤 1**：实现新建作品功能
  - 添加 "新建思维导图" 按钮
  - 实现作品创建逻辑
  - 验证：新建作品功能正常

- **步骤 2**：实现删除作品功能
  - 添加删除按钮和确认对话框
  - 实现作品删除逻辑
  - 验证：删除作品功能正常

#### 4.3 本地状态管理
- **步骤 1**：集成状态管理
  - 连接作品状态与存储服务
  - 实现状态同步
  - 验证：状态管理与存储服务集成正常

### 5. 设置模块

#### 5.1 本地存储的用户偏好
- **步骤 1**：创建设置页面
  - 实现 `src/components/SettingsPage.tsx`
  - 实现通用设置、工作区设置、外观设置
  - 验证：设置页面显示完整

- **步骤 2**：实现设置的本地存储
  - 将用户设置保存到本地存储
  - 实现设置的读取和应用
  - 验证：设置更改后正确保存

#### 5.2 主题切换功能
- **步骤 1**：实现主题设置
  - 添加亮色/暗色/自动主题选项
  - 实现主题切换逻辑
  - 验证：主题切换功能正常

#### 5.3 基础配置项
- **步骤 1**：实现基础配置
  - 添加自动保存设置
  - 添加存储清理设置
  - 验证：基础配置项功能正常

## 验收清单

### 1. 应用脚手架搭建验收
- [x] React + TypeScript 项目初始化成功
- [x] 核心依赖安装完成
- [x] 路由系统配置正确
- [x] Zustand 状态管理集成正常 (已选择使用 Context API 进行状态管理，不使用 Zustand)
- [x] 主题系统配置完成

### 2. 侧边栏与导航系统验收
- [x] 7 个核心模块导航项完整显示
- [x] 导航状态管理正常
- [x] 响应式布局适配不同屏幕尺寸 (已作为后期实现的功能，当前版本优先实现固定布局和窗口大小设置)
- [x] 用户信息展示区域功能完整
- [x] 导航切换动画流畅

### 3. 本地存储系统验收
- [x] IndexedDB 数据库初始化成功
- [x] 基本的 CRUD 操作正常
- [x] 数据加密功能正常工作
- [x] 缓存策略生效，性能良好
- [x] 存储使用情况监控功能可用

### 4. 作品管理基础验收
- [x] 作品列表卡片/网格视图正常显示
- [x] 新建作品功能正常
- [x] 删除作品功能正常
- [x] 作品状态与存储服务同步正常
- [x] 作品缩略图生成功能可用

### 5. 设置模块验收
- [x] 设置页面显示完整
- [x] 用户偏好设置正确保存到本地
- [x] 主题切换功能正常
- [x] 基础配置项功能完整
- [x] 设置更改后应用生效

## 技术要点

### 1. 代码规范
- 遵循 TypeScript 严格模式
- 使用 ESLint 和 Prettier 保持代码风格一致
- 组件命名使用 PascalCase，文件命名与组件名对应

### 2. 性能优化
- 使用 React.memo 和 useMemo 减少不必要的重渲染
- 实现虚拟列表，优化大量作品的渲染
- 合理使用 useCallback 缓存函数

### 3. 安全性
- 数据加密使用 Web Crypto API
- 密钥管理使用安全的存储方式
- 输入验证和错误处理完善

### 4. 可访问性
- 实现键盘导航支持
- 添加适当的 ARIA 标签
- 确保颜色对比度符合标准

## 风险与对策

### 1. 风险：IndexedDB 兼容性问题
- **对策**：添加降级方案，在不支持 IndexedDB 的浏览器中使用 LocalStorage

### 2. 风险：存储加密性能影响
- **对策**：使用 Web Workers 进行加密操作，避免阻塞主线程

### 3. 风险：状态管理复杂度
- **对策**：模块化状态管理，按功能划分不同的 store

### 4. 风险：响应式布局适配
- **对策**：使用 Tailwind 的响应式类，确保在不同设备上的良好体验

## 交付物

1. **代码仓库**：完整的项目代码，包含所有实现的功能
2. **文档**：
   - 项目结构说明
   - 核心模块使用文档
   - 存储系统设计文档
3. **演示**：功能演示视频或截图

## 后续阶段准备

完成本阶段后，团队应准备：
1. 进行代码审查，确保代码质量
2. 准备阶段二的需求分析
3. 收集用户反馈，调整后续功能优先级

---

**注意**：本计划可根据实际开发进度和遇到的问题进行适当调整，确保核心功能的稳定实现。