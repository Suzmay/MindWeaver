# MindWeaver 预览功能设计方案

## 1. 功能概述

预览功能是 MindWeaver 思维导图编辑器的重要组成部分，旨在为用户提供一个专注于查看和展示思维导图的模式。在预览模式下，用户可以更清晰地查看思维导图的整体结构，而不会被编辑工具所干扰。

## 2. 核心功能设计

### 2.1 节点聚焦功能

**功能描述**：
- 点击任意节点时，自动将该节点居中显示并适当放大
- 聚焦后，其他节点保持可见但会适当淡化，突出当前聚焦的节点
- 支持键盘方向键在相邻节点间导航聚焦，并通过箭头指引用户当前准备去往的节点

**实现方案**：
- 使用 `CanvasRenderer` 组件的现有缩放和平移功能
- 增加节点点击事件的聚焦处理逻辑
- 实现节点之间的导航算法，支持上下左右方向键导航

### 2.2 背景线显隐控制

**功能描述**：
- 提供背景网格线的显示/隐藏切换功能
- 提供节点连接线的显示/隐藏切换功能
- 提供节点边框的显示/隐藏切换功能

**实现方案**：
- 在预览模式的工具栏中添加背景线控制按钮
- 通过状态管理控制不同类型线条的显示状态
- 确保线条的显示/隐藏操作不影响编辑模式的设置

### 2.3 思维导图波动效果

**功能描述**：
- 提供思维导图的轻微波动动画效果，增强视觉体验
- 波动效果应该自然、流畅，不会影响用户的正常查看
- 可以控制波动效果的开启/关闭

**实现方案**：
- 使用 CSS 动画或 Canvas 动画实现节点的轻微波动
- 为不同层级的节点设置不同的波动幅度和频率
- 提供波动效果的开关控制

### 2.4 编辑操作锁定

**功能描述**：
- 进入预览模式后，所有节点的编辑功能被锁定
- 鼠标悬停在节点上时不再显示编辑提示
- 双击节点不再触发编辑模式

**实现方案**：
- 在预览模式下禁用节点的点击编辑事件
- 移除预览模式下的上下文菜单
- 确保键盘快捷键在预览模式下不会触发编辑操作

## 3. 界面设计

### 3.1 工具栏设计

**预览模式下的工具栏**：
- **左侧**：返回作品列表按钮（与编辑模式相同，点击时弹出确认弹窗）
- **中间**：
  - 放大/缩小控制
  - 背景线显隐控制
  - 波动效果控制
- **右侧**：
  - 返回编辑界面按钮（位于分享按钮左侧）
  - 分享按钮
  - 导出按钮

**按钮样式**：
- 保持与编辑模式一致的设计风格
- 使用相同的圆角、边框和悬停效果
- 图标使用 lucide-react 库，确保视觉一致性

### 3.2 弹窗设计

**返回作品列表确认弹窗**：
- 弹窗大小与编辑模式相同
- 提示信息："确定要返回作品列表吗？未保存的更改将会丢失。"
- 按钮："取消"、"确定返回"

**返回编辑界面确认弹窗**：
- 如果有未保存的更改，提示用户保存
- 提示信息："您有未保存的更改，是否要保存后再返回编辑？"
- 按钮："不保存"、"取消"、"保存并返回"

## 4. 交互流程

### 4.1 进入预览模式

1. 用户点击编辑模式下的"预览"按钮
2. 系统检查是否有未保存的更改
3. 如果有未保存的更改，弹出保存确认弹窗
4. 用户选择保存或不保存后，进入预览模式
5. 预览模式加载，显示简化的工具栏和完整的思维导图

### 4.2 预览模式操作

1. **节点聚焦**：点击任意节点自动聚焦
2. **导航**：使用方向键在节点间导航
3. **背景控制**：通过工具栏按钮控制背景线显隐
4. **波动效果**：通过工具栏按钮控制波动效果
5. **返回编辑**：点击"返回编辑"按钮，可选择是否保存更改
6. **分享/导出**：使用分享和导出功能
7. **返回作品列表**：点击左侧返回按钮，弹出确认弹窗后返回

### 4.3 退出预览模式

1. **返回编辑**：点击"返回编辑"按钮，保存更改后回到编辑模式
2. **返回作品列表**：点击左侧返回按钮，确认后回到作品列表

## 5. 技术实现要点

### 5.1 状态管理

- 使用 React 状态管理预览模式的开启/关闭
- 维护预览模式下的特殊状态（如背景线显示状态、波动效果状态）
- 确保预览模式的状态不影响编辑模式的设置

### 5.2 组件设计

- 复用现有的 `CanvasRenderer` 组件，但禁用编辑功能
- 创建专门的预览模式工具栏组件
- 实现预览模式的路由或状态切换逻辑

### 5.3 动画实现

- 使用 CSS 动画或 Canvas 动画实现波动效果
- 确保动画性能良好，不影响用户体验
- 提供动画的开启/关闭控制

## 6. 用户体验考虑

### 6.1 易用性

- 预览模式的切换应该简单直观
- 工具栏布局清晰，功能易于理解
- 提供足够的视觉反馈，让用户知道当前处于预览模式

### 6.2 性能

- 预览模式应该加载迅速，响应及时
- 波动动画应该流畅，不影响整体性能
- 确保在大型思维导图下依然保持良好的性能

### 6.3 一致性

- 预览模式的界面风格应该与编辑模式保持一致
- 操作逻辑应该符合用户的预期
- 错误提示和确认弹窗应该清晰明了

## 7. 扩展功能建议

### 7.1 演示模式

- 添加演示模式，自动按层级展开节点
- 支持演示步骤的自定义和保存
- 提供演示控制按钮（播放、暂停、上一步、下一步）
- **理由**：演示模式可以帮助用户更有效地向他人展示思维导图的结构和内容，特别是在会议或演讲场景中。

### 7.2 全屏预览

- 支持全屏预览模式，提供更沉浸式的查看体验
- 全屏模式下依然保留必要的控制按钮
- **理由**：全屏模式可以消除干扰，让用户专注于思维导图的内容，特别适合在大屏幕上展示。

### 7.3 导出预览设置

- 允许用户在导出前设置预览相关的选项（如背景线、波动效果等）
- 支持将预览设置保存为预设
- **理由**：不同的导出场景可能需要不同的预览设置，保存预设可以提高用户的工作效率。

### 7.4 搜索功能

- 在预览模式下添加搜索框，支持关键词搜索节点
- 搜索结果高亮显示，并自动聚焦到第一个匹配的节点
- 支持按标题、内容等不同维度搜索
- **理由**：对于大型思维导图，搜索功能可以帮助用户快速定位到特定的节点，提高查看效率。

### 7.5 缩略图导航

- 提供思维导图的缩略图小地图，显示整体结构
- 支持在缩略图上点击快速定位到相应区域
- 显示当前视图在整体中的位置
- **理由**：缩略图导航可以帮助用户了解思维导图的整体结构，快速在不同区域之间切换。

### 7.6 节点详情查看

- 点击节点时显示详细信息面板，包含完整的节点内容
- 支持在详情面板中查看节点的所有属性和关联信息
- 详情面板可折叠，不影响思维导图的整体查看
- **理由**：节点详情查看可以让用户在不放大节点的情况下查看完整内容，特别适合内容较长的节点。

### 7.7 路径追踪

- 显示从根节点到当前聚焦节点的完整路径
- 路径上的节点高亮显示，帮助用户理解节点在整体结构中的位置
- 支持点击路径上的任意节点快速导航
- **理由**：路径追踪可以帮助用户了解当前节点的上下文关系，特别是在深层级的思维导图中。

### 7.8 暗模式支持

- 在预览模式下支持明暗主题切换
- 自动根据系统主题设置调整，也可手动切换
- 确保在不同主题下思维导图的可读性
- **理由**：暗模式可以减少眼睛疲劳，特别适合在低光环境下使用，提高用户体验。

### 7.9 分享链接生成

- 生成可分享的预览链接，允许他人查看思维导图
- 支持设置链接的有效期和访问权限
- 提供密码保护选项
- **理由**：分享链接功能可以方便用户与他人协作或展示思维导图，而无需共享整个项目。

### 7.10 缩放级别记忆

- 记住用户在预览模式下的缩放偏好
- 在下次进入预览时自动恢复到上次的缩放级别和位置
- 支持为不同的思维导图保存不同的视图设置
- **理由**：缩放级别记忆可以提高用户的工作效率，避免每次进入预览都需要重新调整视图。

### 7.11 多布局切换

- 在预览模式下支持快速切换不同的布局方式（如思维导图、树状、组织结构图等）
- 布局切换不影响编辑模式的设置
- **理由**：不同的布局方式可以帮助用户从不同角度理解思维导图的结构，发现潜在的关系。

### 7.12 注释功能

- 在预览模式下添加临时注释，不影响原始思维导图
- 支持注释的添加、编辑和删除
- 注释可导出为单独的文件
- **理由**：注释功能可以让用户在预览时添加临时的想法或标记，特别适合协作场景。

## 8. 实现路径

1. **阶段一**：实现基本的预览模式切换和工具栏调整
2. **阶段二**：实现节点聚焦和背景线控制功能
3. **阶段三**：实现波动效果和编辑操作锁定
4. **阶段四**：优化用户体验和性能
5. **阶段五**：添加扩展功能

## 9. 总结

预览功能是 MindWeaver 思维导图编辑器的重要组成部分，它为用户提供了一个专注于查看和展示思维导图的模式。通过实现节点聚焦、背景线控制、波动效果等功能，以及优化界面设计和交互流程，可以为用户提供一个直观、流畅、功能丰富的预览体验。

同时，预览模式的设计应该保持与编辑模式的一致性，确保用户能够轻松切换和使用不同模式。通过合理的技术实现和用户体验设计，预览功能可以成为 MindWeaver 的一个亮点特性，提升整体产品的竞争力。