## MindWeaver 功能实现计划

### 0. 项目概述

MindWeaver 是一款功能强大的思维导图工具，专注于提供直观、高效的思维可视化体验。本计划基于项目当前的侧边栏结构（账户、素材、作品、模板、市场、仪表盘、设置），按照功能模块划分实现阶段，优先确保本地存储功能的完整性和稳定性，随后逐步扩展到跨端存储和浏览器使用场景。

### 1. 核心功能范围

#### 1.1 导航与基础框架
- 固定左侧导航栏（7个核心模块入口）
- 右侧工作区容器
- 主题切换
- AI 助手右下角常驻入口

#### 1.2 账户模块
- 头像/昵称/邮箱展示与编辑
- 本地存储的用户偏好设置
- 登录注册集成（跨端存储需要）

#### 1.3 素材中心
- 图标库、形状库、颜色方案
- 连接线样式、背景模板
- 素材管理与预览

#### 1.4 作品集
- 卡片/网格视图展示
- 完整的 CRUD 操作（含废纸篓）
- 重命名、复制、导入/导出
- 作品缩略图生成

#### 1.5 模板集
- 基础模板与自定义模板
- 模板编辑器（主题、形状、连线、字体、动画、布局）
- 模板应用与样式继承

#### 1.6 市场
- 作品、模板、素材的分享功能
- 基于 CloudFlare 的分享机制
- 社区发现与搜索

#### 1.7 仪表盘
- 创作统计、使用分析
- 趋势图表与数据可视化

#### 1.8 设置
- 通用设置、工作区设置、外观设置
- 本地存储配置、自动保存设置
- 主题与界面定制

#### 1.9 思维导图编辑器
- 画布核心（缩放、平移、节点操作）
- 布局系统（右侧发散、树状、组织结构、鱼骨图）
- 样式编辑与动画效果
- 历史版本与撤销/重做

### 2. 实现阶段划分

#### 阶段一：基础框架与本地存储（核心优先）

**目标**：搭建完整的应用框架，实现本地存储功能，确保基本可用性

**具体实现**：
1. **应用脚手架搭建**
   - **项目初始化**：使用 Vite 创建 React + TypeScript 项目
   - **依赖配置**：安装核心依赖（zustand、tailwindcss、framer-motion 等）
   - **路由系统**：配置 react-router-dom，定义 7 个核心模块的路由
   - **状态管理**：实现主题、用户、作品的状态管理
   - **主题系统**：配置 Tailwind CSS，实现亮色/暗色主题切换

2. **侧边栏与导航系统**
   - **导航结构**：实现 7 个核心模块的导航项（账户、素材、作品、模板、市场、仪表盘、设置）
   - **状态管理**：为导航项添加激活状态，实现悬停、点击效果
   - **用户信息**：实现用户头像、昵称、邮箱展示，添加编辑入口
   - **交互设计**：实现导航切换的平滑过渡效果

3. **本地存储系统**
   - **IndexedDB 实现**：创建数据库适配器，实现基本的 CRUD 操作
   - **数据加密**：基于 Web Crypto API 实现数据加密与安全存储
   - **缓存策略**：实现 LRU 缓存，优化存储性能
   - **监控系统**：添加存储使用情况统计，实现存储清理建议
   - **性能优化**：实现数据分片存储，配置缓存清理定时器

4. **作品管理基础**
   - **列表展示**：实现作品卡片/网格视图，显示作品基本信息
   - **基本操作**：实现新建作品、删除作品功能
   - **状态同步**：连接作品状态与存储服务，实现状态同步
   - **缩略图**：实现作品缩略图生成功能

5. **设置模块**
   - **页面结构**：实现通用设置、工作区设置、外观设置
   - **用户偏好**：将用户设置保存到本地存储，实现设置的读取和应用
   - **主题设置**：添加亮色/暗色/自动主题选项
   - **基础配置**：添加自动保存设置、存储清理设置等

#### 阶段二：核心编辑功能

**目标**：实现思维导图编辑器的核心功能，支持基本的编辑操作，确保编辑体验流畅直观

**具体实现**：
1. **思维导图画布**
   - **渲染引擎**：Canvas/WebGL 混合渲染
   - **坐标系统**：无限画布，支持缩放和平移
   - **性能优化**：视口裁剪，按需渲染
   - **交互功能**：拖拽选择，多选操作，框选

2. **节点编辑系统**
   - **基础操作**：节点创建、编辑、删除
   - **文本编辑**：富文本支持，格式化选项
   - **样式定制**：形状、颜色、字体、图标
   - **属性面板**：实时预览，批量编辑

3. **连线系统**
   - **自动连线**：智能路径算法，避免交叉
   - **样式选项**：直线、曲线、贝塞尔曲线
   - **箭头样式**：多种箭头类型
   - **动画效果**：连线动画与过渡效果
   - **关系类型**：支持不同类型的节点关系

4. **布局系统**
   - **布局模式**：思维导图、树状、组织结构、鱼骨图
   - **自动布局**：基于层级的智能布局
   - **参数调整**：层级间距，节点间距
   - **方向控制**：水平、垂直、放射状

5. **历史版本管理**
   - **撤销/重做**：多级历史记录
   - **版本快照**：定时自动保存，手动快照
   - **差异存储**：基于差异的增量存储
   - **版本恢复**：历史版本预览与恢复

#### 阶段三：素材与模板系统

**目标**：实现素材中心和模板系统，支持丰富的视觉元素，提高创作效率

**具体实现**：
1. **素材中心**
   - **内置素材库**：图标、形状、连接线样式
   - **素材预览**：实时预览，拖拽使用
   - **分类管理**：按类型、风格、用途分类
   - **搜索功能**：快速定位所需素材

2. **模板系统**
   - **基础模板库**：业务、教育、个人等类别
   - **模板编辑器**：可视化模板创建
   - **样式继承**：模板样式应用到新作品
   - **模板预览**：缩略图展示，详情查看

3. **样式系统**
   - **主题管理**：预设主题，自定义主题
   - **颜色方案**：和谐配色，自定义调色板
   - **字体系统**：多字体支持，字体大小调整
   - **排版控制**：对齐方式，行间距

4. **动画系统**
   - **节点动画**：入场、强调、退场动画
   - **过渡效果**：平滑过渡，时间控制
   - **动画强度**：可调节动画效果强度
   - **性能优化**：动画帧率控制

#### 阶段四：高级功能与市场

**目标**：实现高级功能和市场系统，扩展应用能力，构建社区生态

**具体实现**：
1. **导入/导出系统**
   - **格式支持**：.mm、.xmind、.json
   - **图像导出**：PNG、SVG、PDF
   - **分享机制**：分享码生成，一键分享
   - **数据迁移**：不同格式间的转换

2. **市场功能**
   - **作品分享**：Cloudflare R2 存储，公开/私有设置
   - **发现机制**：热门推荐，分类浏览，搜索功能
   - **社区互动**：评论，点赞，收藏
   - **版本控制**：作品更新与历史版本

3. **仪表盘**
   - **创作统计**：作品数量，创作时长，修改频率
   - **使用分析**：功能使用情况，性能指标
   - **趋势图表**：创作活跃度，素材使用统计
   - **个性化建议**：基于使用习惯的推荐

4. **AI 助手**
   - **智能问答**：功能指导，使用建议
   - **命令式操作**：自然语言指令执行
   - **内容生成**：节点内容建议，结构优化
   - **首次引导**：新用户引导流程，功能介绍

5. **作品排序功能**
   - **长按拖移**：支持长按作品卡片进行拖移操作
   - **顺序调整**：通过拖放更改作品在列表中的显示顺序
   - **实时反馈**：拖移过程中显示视觉反馈，如占位符和拖放提示
   - **持久化存储**：保存用户调整后的作品顺序到本地存储
   - **性能优化**：实现平滑的拖移动画，确保在大量作品时仍保持流畅
   - **兼容性**：支持鼠标和触摸设备的拖放操作

#### 阶段五：跨端存储与浏览器支持

**目标**：实现 Cloudflare 支持的跨端存储和浏览器使用，确保数据安全与同步

**具体实现**：
1. **Cloudflare 集成**
   - **认证系统**：自定义登录注册
   - **数据存储**：Cloudflare R2 存储作品和素材
   - **跨设备同步**：实时同步，离线编辑

2. **浏览器使用**
   - **存储优化**：IndexedDB + LocalStorage 策略
   - **离线支持**：Service Worker 缓存，离线操作
   - **响应式设计**：适配桌面、平板、移动设备
   - **性能优化**：代码分割，懒加载

3. **安全与隐私**
   - **数据加密**：传输加密，存储加密
   - **访问控制**：权限管理，隐私设置
   - **安全审计**：定期安全检查，漏洞修复

4. **性能优化**
   - **加载速度**：资源预加载，缓存策略
   - **渲染性能**：WebGL 加速，视口裁剪
   - **存储性能**：数据压缩，索引优化
   - **网络优化**：边缘缓存，CDN 加速

### 3. 存储策略

#### 3.1 本地存储（优先实现）

**技术方案**：
- **数据库**：IndexedDB
- **加密**：Web Crypto API
- **缓存**：LRU 内存缓存
- **分片**：大作品分片存储

**核心功能**：
- 作品、模板、素材的本地持久化
- 数据加密与安全保护
- 存储使用情况监控
- 自动清理与优化

#### 3.2 Cloudflare 认证与存储系统

**技术方案**：
- **认证服务**：Cloudflare Workers + KV
- **用户存储**：Cloudflare KV
- **文件存储**：Cloudflare R2
- **边缘计算**：Cloudflare Workers

**核心功能**：
- 自定义登录注册系统
- 跨设备数据同步
- 用户偏好设置存储
- 全球边缘网络加速

#### 3.3 浏览器使用

**技术方案**：
- **存储限制**：IndexedDB + LocalStorage
- **登录机制**：Cloudflare 认证系统
- **离线支持**：Service Worker 缓存
- **数据迁移**：本地与 Cloudflare 存储同步

**核心功能**：
- 浏览器端完整功能支持
- 响应式设计适配
- 离线操作与自动同步
- 数据安全与隐私保护

### 4. 市场功能实现方案

#### 4.1 核心概念

**市场**是 MindWeaver 的社区功能，允许用户分享和发现思维导图作品、模板和素材。基于 Cloudflare 服务实现，利用 Workers、KV 和 R2 构建完整的社区生态系统。

#### 4.2 实现方式

1. **分享机制**
   - 将作品/模板/素材导出为标准格式
   - 存储到 Cloudflare R2
   - 在 Cloudflare KV 中索引元数据
   - 生成唯一分享链接

2. **发现机制**
   - 基于 Cloudflare KV 的搜索功能
   - 标签与分类系统
   - 热门与推荐算法
   - 边缘缓存加速访问

3. **使用流程**
   - 浏览市场内容
   - 预览作品效果
   - 导入到本地使用
   - 反馈与评价

#### 4.3 技术实现

1. **Cloudflare 服务集成**
   - Workers 作为 API 后端
   - R2 存储用户分享内容
   - KV 存储元数据和索引
   - 边缘计算处理请求

2. **数据格式**
   - 作品：标准思维导图格式
   - 模板：样式与结构定义
   - 素材：JSON 元数据 + 资源

3. **缓存策略**
   - Cloudflare CDN 缓存静态资源
   - 本地缓存热门内容
   - 增量更新机制
   - 离线访问支持

### 5. 思维导图和模板创建实现

#### 5.1 思维导图编辑器核心

**画布实现**：
- **渲染引擎**：Canvas/WebGL 混合渲染
- **坐标系统**：无限画布，支持缩放和平移
- **性能优化**：视口裁剪，按需渲染

**节点系统**：
- **节点类型**：文本、图像、链接
- **样式属性**：形状、颜色、字体、图标
- **交互功能**：拖拽、调整大小、连接

**连线系统**：
- **连线类型**：直线、曲线、贝塞尔曲线
- **箭头样式**：多种箭头类型
- **动画效果**：连线动画与过渡

**布局算法**：
- **树形布局**：层次分明的树状结构
- **思维导图布局**：中心发散式
- **组织结构图**：层级结构
- **鱼骨图**：因果分析布局

#### 5.2 模板创建系统

**模板结构**：
- **基础信息**：名称、描述、预览图
- **样式定义**：主题、配色方案
- **布局模板**：预设布局结构
- **元素库**：常用节点和连线样式

**模板编辑器**：
- **样式面板**：主题、颜色、字体设置
- **布局面板**：布局类型与参数调整
- **动画面板**：动画效果与参数
- **预览功能**：实时预览模板效果

**模板应用**：
- **样式继承**：模板样式应用到新作品
- **结构应用**：预设结构的快速使用
- **自定义修改**：基于模板的个性化调整

### 6. 技术架构

#### 6.1 前端技术栈

| 类别 | 技术 | 版本 | 用途 |
|------|------|------|------|
| 应用框架 | React + TypeScript | 最新 | 核心应用构建 |
| 状态管理 | Zustand | 最新 | 全局状态管理 |
| UI 库 | Tailwind CSS + Radix UI | 最新 | 界面组件 |
| 画布渲染 | Canvas API + WebGL | 浏览器原生 | 思维导图渲染 |
| 布局引擎 | elkjs + dagre | 最新 | 自动布局算法 |
| 本地存储 | IndexedDB | 浏览器原生 | 本地数据持久化 |
| 加密 | Web Crypto API | 浏览器原生 | 数据安全 |
| 网络请求 | Fetch API | 浏览器原生 | API 调用 |
| 动画 | Framer Motion | 最新 | 界面动画 |
| 部署平台 | Cloudflare Pages | 最新 | 应用托管与部署 |
| 边缘计算 | Cloudflare Workers | 最新 | API 代理与处理 |
| 云端存储 | Cloudflare R2 + KV | 最新 | 素材与数据存储 |

#### 6.2 存储架构

```
┌─────────────────┐
│ 应用层          │
├─────────────────┤
│ 存储服务        │
├─────────────────┤
│ 缓存层          │
├─────────────────┤
│ 加密层          │
├─────────────────┤
│ 数据适配器      │
├─────────────────┤
│ IndexedDB      │
├─────────────────┤
│ Cloudflare R2  │
├─────────────────┤
│ Cloudflare KV  │
└─────────────────┘
```

#### 6.3 组件架构

```
┌─────────────────┐
│ AppShell        │
├─────────────────┤
│ ├── Sidebar     │
│ └── ContentArea │
│     ├── WorksPage      │
│     ├── TemplatesPage  │
│     ├── AssetsPage     │
│     ├── MarketPage     │
│     ├── DashboardPage  │
│     ├── AccountPage    │
│     ├── SettingsPage   │
│     └── MindCanvas     │
└─────────────────┘
```

### 7. 质量标准

#### 7.1 性能标准
- **响应时间**：界面操作响应时间 < 100ms
- **渲染性能**：支持 ≥ 1000 节点的思维导图流畅编辑
- **加载速度**：首次加载时间 < 3s
- **内存使用**：稳定状态内存使用 < 500MB

#### 7.2 功能标准
- **完整度**：所有核心功能实现并可正常使用
- **一致性**：界面风格和交互模式一致
- **可靠性**：数据存储和读取无丢失
- **安全性**：用户数据加密存储

#### 7.3 代码标准
- **代码规范**：TypeScript 严格模式，ESLint + Prettier
- **测试覆盖率**：核心功能测试覆盖率 ≥ 80%
- **文档完善**：关键模块有详细文档
- **可维护性**：模块化设计，代码结构清晰

### 8. 验收清单

#### 8.1 基础框架
- [ ] 侧边栏导航完整，7个模块入口可用
- [ ] 主题切换功能正常
- [ ] 响应式布局适配
- [ ] AI 助手入口可见

#### 8.2 本地存储
- [ ] 作品本地存储正常
- [ ] 数据加密功能可用
- [ ] 存储使用情况监控
- [ ] 缓存策略生效

#### 8.3 思维导图编辑器
- [ ] 画布渲染正常
- [ ] 节点编辑功能完整
- [ ] 连线系统可用
- [ ] 多种布局模式支持
- [ ] 撤销/重做功能正常

#### 8.4 模板系统
- [ ] 基础模板可用
- [ ] 模板编辑器功能完整
- [ ] 模板应用到新作品
- [ ] 样式继承正常

#### 8.5 素材中心
- [ ] 素材库加载正常
- [ ] 素材预览功能可用
- [ ] 素材应用到作品
- [ ] 素材分类管理

#### 8.6 市场功能
- [ ] 作品分享功能
- [ ] 市场内容浏览
- [ ] 导入分享的作品
- [ ] Cloudflare 存储集成

#### 8.7 跨端存储
- [ ] Cloudflare 存储同步
- [ ] 跨设备访问
- [ ] 浏览器端使用
- [ ] 离线操作支持

#### 8.8 认证系统
- [ ] 自定义登录注册功能
- [ ] JWT 令牌认证
- [ ] 密码重置功能
- [ ] 用户信息管理

### 9. 风险与对策

#### 9.1 性能风险
- **风险**：大型思维导图渲染性能
- **对策**：实现视口裁剪，按需渲染，使用 WebGL 加速

#### 9.2 存储风险
- **风险**：本地存储容量限制
- **对策**：实现数据压缩，自动清理过期数据，分片存储大型作品

#### 9.3 兼容性风险
- **风险**：不同浏览器兼容性
- **对策**：使用标准 Web API，添加兼容性检查和降级方案

#### 9.4 安全风险
- **风险**：本地数据安全
- **对策**：使用 Web Crypto API 加密，实现安全的密钥管理

#### 9.5 Cloudflare 服务风险
- **风险**：Cloudflare 免费额度限制
- **对策**：监控使用量，优化存储和请求策略，设置合理的缓存机制

#### 9.6 认证系统风险
- **风险**：用户数据安全
- **对策**：使用 HTTPS，实现密码加密存储，配置适当的访问控制

### 10. Cloudflare 完整解决方案

#### 10.1 架构设计

**核心流程**：
1. **代码管理**：GitHub 仓库作为代码源（仅用于版本控制）
2. **自动部署**：GitHub Actions 触发 Cloudflare Pages 部署
3. **认证系统**：Cloudflare Workers + KV 实现自定义登录注册
4. **存储方案**：Cloudflare R2 + KV 作为唯一云端存储

**技术实现**：
- **CI/CD 流水线**：GitHub Actions 配置文件
- **部署触发器**：推送到 main 分支自动部署
- **环境隔离**：开发/预览/生产环境
- **缓存策略**：Cloudflare CDN 缓存静态资源

#### 10.2 实现步骤

1. **Cloudflare 账户设置**
   - 创建 Cloudflare 账户
   - 配置 Pages 项目
   - 启用 R2 和 KV 服务
   - 设置自定义域名

2. **认证系统实现**
   - 使用 Workers 实现登录注册 API
   - 利用 KV 存储用户信息
   - 实现 JWT 令牌认证
   - 配置密码重置功能

3. **存储服务配置**
   - 配置 R2 存储桶用于文件存储
   - 设置 KV 命名空间用于数据存储
   - 实现数据同步机制
   - 配置访问控制策略

4. **部署配置**
   - 创建 `cloudflare.yml` 配置文件
   - 配置构建命令和输出目录
   - 设置环境变量和 secrets

5. **前端集成**
   - 实现登录注册界面
   - 集成认证状态管理
   - 实现数据同步逻辑
   - 配置错误处理和重试机制

#### 10.3 优势与收益

- **全球访问**：Cloudflare 边缘网络加速
- **免费额度**：充分利用 Cloudflare 免费计划
- **完整控制**：自定义认证和存储系统
- **简化架构**：单一云服务提供商
- **安全可靠**：Cloudflare 企业级安全
- **可扩展性**：按需扩展存储和计算资源

### 11. 总结

本计划基于 MindWeaver 项目的当前状态，按照功能模块划分实现阶段，优先确保本地存储功能的完整性和稳定性，随后通过 Cloudflare 服务实现跨端存储和浏览器使用场景。重点关注思维导图编辑器和模板创建系统的实现，同时利用 Cloudflare 构建完整的认证和存储系统。

通过本计划的实施，MindWeaver 将成为一款功能完整、性能优异、用户友好的思维导图工具，具有以下特点：

- **自定义登录注册系统**：基于 Cloudflare Workers 和 KV 实现
- **全球部署与加速**：利用 Cloudflare 边缘网络
- **多层次存储策略**：本地存储 + Cloudflare R2/KV
- **完整的市场功能**：基于 Cloudflare 服务的社区生态
- **免费额度利用**：充分利用 Cloudflare 免费计划

取消 GitHub 存储方案后，项目将完全依赖 Cloudflare 服务实现云端存储和跨设备同步，简化了技术架构，提高了系统的一致性和可靠性。